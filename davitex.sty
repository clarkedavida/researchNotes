%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                             %
% davitex.sty                                                                 %
% by: David Clarke                                                            %
%                                                                             %
% Style file with my commonly used definitions, to be included at the         %
% beginning of most LaTeX main .tex files.                                    %
%                                                                             %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Packages needed to use these commands: 
%\usepackage{amsmath,amssymb}
%\usepackage{graphicx,multirow,tabularx}

  % General mathematics
\newcommand{\set}[1]{\left\{#1\right\}}
\newcommand{\degree}{^{\circ}}
%\newcommand{\st}{{}^{\rm st}}  % 1st
\newcommand{\nd}{{}^{\rm nd}}  % 2nd
\newcommand{\rd}{{}^{\rm rd}}  % 3nd
\newcommand{\nth}{{}^{\rm th}} % nth
\newcommand{\dimens}[1]{#1-$d$}
\renewcommand{\Re}{\mathop{\mathrm{Re}}}
\renewcommand{\Im}{\mathop{\mathrm{Im}}}
\newcommand{\ltsim}{\lesssim} % seriously who the fuck named these two
\newcommand{\gtsim}{\gtrsim}
\newcommand{\suchthat}{~\text{s.t.}~}
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\principal}{\mathcal{P}}
\newcommand{\continuous}{\mathcal{C}}
\newcommand{\topol}[1]{\operatorname{\mathcal{O}}_{#1}}
\newcommand{\diag}{\mathop{\mathrm{diag}}}
\newcommand{\id}{{\mathbf 1}}
\newcommand{\zd}{{\mathbf 0}}
\newcommand{\dual}[1]{{}^{*\hspace{-1mm}}{#1}}
\newcommand{\sign}{\text{sign}}
\newcommand{\mat}[2]{\left(#1\right)_{#2}} % matrix element
\DeclareDocumentCommand\DD{ o g d() }{
  % o: optional n for nth differential
  % g: optional argument for readability and to control spacing
  % d: long-form as in d(cos x)
  \IfNoValueTF{#2}{
    \IfNoValueTF{#3}
      {\mathcal{D}\IfNoValueTF{#1}{}{^{#1}}}
      {\mathinner{\mathcal{D}\IfNoValueTF{#1}{}{^{#1}}\argopen(#3\argclose)}}
  }
  {\mathinner{\mathcal{D}\IfNoValueTF{#1}{}{^{#1}}#2} \IfNoValueTF{#3}{}{(#3)}}
}


  % Probability
\newcommand{\pr}[1]{\operatorname{pr}\left(#1\right)}
\newcommand{\prt}[1]{\operatorname{T}\left(#1\right)}
\newcommand{\tauint}{\tau_\text{int}}
\DeclareMathOperator{\gau}{gau}
\DeclareMathOperator{\cau}{cau}
\DeclareMathOperator{\Gau}{Gau}
\DeclareMathOperator{\Cau}{Cau}
\DeclareMathOperator{\Cov}{cov}
\DeclareMathOperator{\variance}{var}
\newcommand{\chidof}{\chi^2/\text{d.o.f.}}
\newcommand{\given}{\,|\,}
\newcommand{\nboot}{N_{\text{boot}}}
\newcommand{\Nboot}{\nboot}


  % General Physics
\newcommand{\Lagr}{\mathcal{L}} 
\newcommand{\Qin}{Q_{\text{in}}}
\newcommand{\Qsuck}{Q_{\text{suck}}}
\newcommand{\Qlost}{Q_{\text{lost}}}
\newcommand{\Qdump}{Q_{\text{dump}}}
\newcommand{\atFixed}[2]{\left(#1\right)_{#2}}
\newcommand{\grandZ}{\mathcal{Z}}         % grand partition function
  % QFT
\newcommand{\MS}{\overline{\text{MS}}}
\newcommand{\T}{\mathbf T}                % time-ordered product
\newcommand{\qconj}{\mathcal{C}}
\newcommand{\parity}{\mathcal{P}}
\newcommand{\Dright}{\overrightarrow{D\strut}}
\newcommand{\Dleft}{\overleftarrow{D\strut}}
\DeclareMathOperator{\Br}{Br}             % branching ratio
\newcommand{\ME}{\mathcal{M}}             % matrix element 
\newcommand{\psibar}{\bar{\psi}}
\newcommand{\ren}{^{\rm ren}}           % renormalized
\newcommand{\bare}{^{\rm bare}}         % bare
  % LFT
\newcommand{\LAT}{\mathbf L}              % lattice
\newcommand{\nconf}{N_{\text{conf}}}
\newcommand{\Nconf}{\nconf}
\renewcommand{\nsim}{N_{\text{sim}}}
\newcommand{\Nsim}{\nsim}
\newcommand{\plaq}{U^\square}
\newcommand{\UHISQ}{U^{\rm HISQ}}         % HISQ smear
  % QCD
\newcommand{\amuhvp}{a_\mu^{\rm HVP}}     % leading HVP contribution to a_mu
\newcommand{\ZQCD}{\grandZ_{\rm QCD}}     % QCD partition func
\newcommand{\LQCD}{\Lambda_{\rm QCD}}     % QCD effective cutoff 
  % Phase diagram 
\newcommand{\fas}{f_{\text{as}}}
\newcommand{\fsing}{f_{\text{sing}}}
\newcommand{\freg}{f_{\text{reg}}}
\newcommand{\pbp}{\bar{\psi}\psi}         % chiral condensate
\newcommand{\muh}{\hat{\mu}}              % mu/T
\newcommand{\TRW}{T_{\rm RW}}             % roberge-weiss
\newcommand{\Tc}{T_{\rm c}}               % critical temp
\newcommand{\Tpc}{T_{\rm pc}}             % pseudo-critical temp
\newcommand{\Td}{T_{\rm d}}               % deconfinement temp

  % Group and algebra names
\DeclareMathOperator{\ON}{\text{O}}
\DeclareMathOperator{\SU}{SU}
\DeclareMathOperator{\SO}{SO}
\DeclareMathOperator{\U}{U}
\DeclareMathOperator{\GL}{GL}
\DeclareMathOperator{\su}{\mathfrak{su}}


  % Nice looking exists and forall
\DeclareMathOperator{\Exists}{\exists}
\DeclareMathOperator{\Forall}{\forall}


  % Sine and cosine shorthand
\DeclareMathOperator{\s}{s}
\DeclareMathOperator{\co}{c}


  % Corporate branding
\newcommand{\simulat}{\texttt{SIMULATeQCD}}


  % Some other useful stuff (trying to follow APS conventions)
\newcommand{\tinysp}{\hspace{0.1mm}}
\newcommand{\secref}[1]{Sec.~\ref{#1}}
\newcommand{\chref}[1]{Chapter~\ref{#1}}
\newcommand{\apref}[1]{Appendix~\ref{#1}}
\newcommand{\propref}[1]{Proposition~\ref{#1}}
\newcommand{\corref}[1]{Corollary~\ref{#1}}
\newcommand{\thmref}[1]{Theorem~\ref{#1}}
\newcommand{\lemref}[1]{Lemma~\ref{#1}}
\newcommand{\equatref}[1]{Eq.~\eqref{#1}}
\newcommand{\figref}[1]{Fig.~\ref{#1}}
\newcommand{\tabref}[1]{Table~\ref{#1}}


% This section defines colvec, which lets me make column
% vectors more easily. \colvec{N}{a1}{a2}...{aN}
\newcount\colveccount
\newcommand*\colvec[1]{
        \global\colveccount#1
        \begin{pmatrix}
        \colvecnext
}
\def\colvecnext#1{
        #1
        \global\advance\colveccount-1
        \ifnum\colveccount>0
                \\
                \expandafter\colvecnext
        \else
                \end{pmatrix}
        \fi
}

% Cell alignment in tables.
\newcommand{\cjcell}[1]{\multicolumn{1}{c}{#1}}
\newcommand{\rjcell}[1]{\multicolumn{1}{r}{#1}}
\newcommand{\ljcell}[1]{\multicolumn{1}{l}{#1}}

% Creates a centered column in such a way that the table fills the
% width of the page. The other commands are other alignments
\newcolumntype{C}{>{\centering\arraybackslash}X}
\newcolumntype{L}{>{\raggedright\arraybackslash}X}
\newcolumntype{R}{>{\raggedleft\arraybackslash}X}

%
% What follows is a bunch of stuff to make a new command, mycode,
% that makes code input look nice.
%
\definecolor{bgcolor}{RGB}{247,247,247}
\definecolor{frcolor}{RGB}{227,227,227}
\usepackage{caption}
\captionsetup[listing]{
    justification=raggedright,
    singlelinecheck=off,
}
\setlength{\belowcaptionskip}{20pt}
\usepackage[section]{minted}
\usepackage{newfloat}
\DeclareFloatingEnvironment[
  fileext = lol,
  listname = {List of Listings},
  name = Listing
]{code}
\usepackage[many]{tcolorbox}
\tcbuselibrary{minted}

\newtcbinputlisting{\mycode}[2]{%
  listing engine=minted,%
  minted language={#1},%
  listing file={#2},%
  minted options={%
    xleftmargin=3.2em,%
    autogobble=true,%
    numbers=left,%
    numbersep=1em,%
    baselinestretch=1.2,%
    fontsize=\fontsize{8.5}{8},%
    breaklines=true,%
    },%
  listing only,%
  enhanced jigsaw,%
  colframe=black,%
  sharp corners,%
  boxrule=1pt,%
  colback=bgcolor,%
  left=-1.5em,%
  left skip=0em,%
  width=\textwidth,%
  overlay={\begin{tcbclipinterior}\fill[frcolor] (frame.south west)
        rectangle ([xshift=5.1mm]frame.north west);\end{tcbclipinterior}},
}

\newtcbinputlisting{\mycodeSnippet}[4]{%
  listing engine=minted,%
  minted language={#1},%
  listing file={#2},%
  minted options={%
    xleftmargin=3.2em,%
    autogobble=true,%
    numbers=left,%
    numbersep=1em,%
    baselinestretch=1.2,%
    fontsize=\fontsize{8.5}{8},%
    breaklines=true,%
    firstline={#3},%
    lastline={#4},%
    },%
  listing only,%
  enhanced jigsaw,%
  colframe=black,%
  sharp corners,%
  boxrule=1pt,%
  colback=bgcolor,%
  left=-1.5em,%
  left skip=0em,%
  width=\textwidth,%
  overlay={\begin{tcbclipinterior}\fill[frcolor] (frame.south west)
        rectangle ([xshift=5.1mm]frame.north west);\end{tcbclipinterior}},
}


%
% This makes the \ff environment, which makes code quotations look nice.
%
\makeatletter
\newcommand\ff@print[1]{%
  \textnormal{%
    \ifdefined\ff@sf\sffamily\else\ttfamily\fi%
    \ifdefined\ff@bold\fontseries{b}\selectfont\fi%
    #1%
  }%
}
\makeatother
\makeatletter\newcommand\ff@rule
  {\vrule height 6pt depth 1pt width 0pt}
\makeatother
\makeatletter
\ifdefined\ff@noframes\else
  \RequirePackage{tcolorbox}
  \newtcbox\ff@box{nobeforeafter,colframe=gray!80!white,
    colback=bgcolor,boxrule=0.1pt,arc=1pt,
    boxsep=1.2pt,left=0.5pt,right=0.5pt,top=0.2pt,bottom=0.2pt,
    tcbox raise base}
\fi
\makeatother
\makeatletter
\NewDocumentCommand\ff@x{v}{\ff{#1}}
\makeatother
\makeatletter
\newcommand\ff[1]{%
  \ifdefined\ff@noframes%
    \ff@rule\ff@print{#1}%
  \else%
    \relax\ifmmode%
      \ff@rule\ff@print{#1}%
    \else%
      \ff@box{\ff@rule\ff@print{#1}}%
    \fi%
  \fi%
}
\makeatother
